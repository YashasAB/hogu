
modules = ["nodejs-20"]

# IDE Run button (local dev)
run = "bash -lc \"pnpm dev\""

[nix]
channel = "stable-25_05"
packages = ["psmisc", "lsof"]

[deployment]
build = ["bash","-lc","set -e; corepack enable; corepack prepare pnpm@8.15.6 --activate; pnpm -v; rm -rf apps/api/dist; pnpm install --no-frozen-lockfile; pnpm -C apps/api install --no-frozen-lockfile; pnpm -C apps/api prisma generate; pnpm -C apps/api build; mkdir -p apps/api/data; export DATABASE_URL=${DATABASE_URL:-file:./data/prod.db}; pnpm -C apps/api prisma migrate deploy || pnpm -C apps/api prisma db push"]
run = ["bash","-lc","cd apps/api && exec env NODE_ENV=production node dist/index.js"]

[objectStorage]
defaultBucketID = "replit-objstore-5d4a1c81-2e13-484c-92e0-96c3c7f4803f"

[[ports]]
localPort = 5000
externalPort = 5000

[[ports]]
localPort = 5001
externalPort = 3001

[[ports]]
localPort = 5555
externalPort = 3000

[[ports]]
localPort = 8080
externalPort = 80
